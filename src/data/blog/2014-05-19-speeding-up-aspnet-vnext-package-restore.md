---
layout: post
title: "Speeding up ASP.NET vNext package restore"
pubDatetime: 2014-05-19T07:23:00Z
comments: true
published: true
categories: ["post"]
tags: ["ASP.NET", "CSharp", "General", "MVC", "NuGet", "WebAPI"]
author: Maarten Balliauw
---
<p><em>TL;DR: If you have multiple NuGet feeds configured on your machine, it may be worth to do some tweaking in the NuGet.config file shipping with your project.</em></p><p>Last week, the ASP.NET team released a preview of “<a href="http://www.asp.net/vnext">ASP.NET vNext</a>”, a first step in the good direction for <a href="/post/2014/04/11/Building-NET-projects-is-a-world-of-pain-and-heres-how-we-should-solve-it.aspx">solving the pain building .NET projects is</a>, but more than that a great step towards having an open and cross-platform ASP.NET that is super developer friendly. If you haven’t checked it out yet, <a href="http://www.asp.net/vnext">do so now</a>.</p> <p>One of the things ASP.NET vNext leans on heavily is NuGet. In fact, every application comes with a <em>project.json</em> file that describes an application’s dependencies. Only when running <em>kpm restore</em> these dependencies are downloaded and the application can be run. Running this package restore (it’s NuGet after all) is usually pretty fast, but if you, like me, are a heavy NuGet user, chances are the restore is not happening in the most optimal way. Have a look at the output of my <em>kpm restore</em> command right after I installed ASP.NET vNext on my system:</p> <p><a href="/images/image_323.png"><img width="644" height="329" title="Project K package restore" style="border: 0px currentColor; border-image: none; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" alt="Project K package restore" src="/images/image_thumb_283.png" border="0"></a></p> <p>It’s not easy to capture a screenshot that proves the point I'm about to make, but if you do this yourself and you have multiple NuGet feeds configured on your system, you’ll see that ASP.NET vNext is trying to restore packages from all configured feeds. In my case, I’m using a <a href="http://www.myget.org">personal feed on MyGet</a>, a feed hosted on my <a href="http://www.jetbrains.com/teamcity">TeamCity</a> server, a feed on my local filesystem (testing purposes) and then the ASP.NET vNext MyGet feed as well as <a href="http://www.nuget.org">NuGet.org</a>. That’s 5 feeds being checked over and over again for the dependencies listed in my <em>project.json</em>… Let’s see if we can reduce this a bit.</p> <p>If we look at the <a href="http://github.com/aspnet/Home">samples</a> shipped in ASP.NET vNext, we can find a <em>NuGet.config</em> file in there. And as we know, NuGet has this thing called <a href="/post/2014/03/11/NuGet-Configuration-File-inheritance-is-awesome.aspx">configuration file inheritance</a>. This means that the feeds defined in here will be enriched&nbsp;with the feeds configured at the machine level, in my case 5 of them. But that also means we can easily fix this: adding a <em>&lt;clear /&gt; </em>element under the <em>&lt;packageSources&gt;</em> element will do the trick of removing all previously defined feeds and using just the ones defined for the project I’m working on:</p> <div class="wlWriterEditableSmartContent" id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:2245cc39-61ef-4092-a04e-668688ee414c" style="margin: 0px; padding: 0px; float: none; display: inline;"><pre style="width: 640px; height: 200px; overflow: auto; background-color: white;"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: rgb(0, 0, 255);">&lt;?</span><span style="color: rgb(255, 0, 255);">xml version="1.0" encoding="utf-8"</span><span style="color: rgb(0, 0, 255);">?&gt;</span><span style="color: rgb(0, 0, 0);">
</span><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(128, 0, 0);">configuration</span><span style="color: rgb(0, 0, 255);">&gt;</span><span style="color: rgb(0, 0, 0);">
  </span><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(128, 0, 0);">packageSources</span><span style="color: rgb(0, 0, 255);">&gt;</span><span style="color: rgb(0, 0, 0);">
    </span><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(128, 0, 0);">clear </span><span style="color: rgb(0, 0, 255);">/&gt;</span><span style="color: rgb(0, 0, 0);">
    </span><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(128, 0, 0);">add </span><span style="color: rgb(255, 0, 0);">key</span><span style="color: rgb(0, 0, 255);">="AspNetVNext"</span><span style="color: rgb(255, 0, 0);"> value</span><span style="color: rgb(0, 0, 255);">="https://www.myget.org/F/aspnetvnext/"</span><span style="color: rgb(255, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">/&gt;</span><span style="color: rgb(0, 0, 0);">
    </span><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(128, 0, 0);">add </span><span style="color: rgb(255, 0, 0);">key</span><span style="color: rgb(0, 0, 255);">="NuGet.org"</span><span style="color: rgb(255, 0, 0);"> value</span><span style="color: rgb(0, 0, 255);">="https://nuget.org/api/v2/"</span><span style="color: rgb(255, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">/&gt;</span><span style="color: rgb(0, 0, 0);">
  </span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(128, 0, 0);">packageSources</span><span style="color: rgb(0, 0, 255);">&gt;</span><span style="color: rgb(0, 0, 0);">
  </span><span style="color: rgb(0, 128, 0);">&lt;!--</span><span style="color: rgb(0, 128, 0);"> ... </span><span style="color: rgb(0, 128, 0);">--&gt;</span><span style="color: rgb(0, 0, 0);">
</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(128, 0, 0);">configuration</span><span style="color: rgb(0, 0, 255);">&gt;</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Use this trick for your own ASP.NET vNext projects as well: specify the feeds you want to use explicitly and everything will be faster for you and other developers working with your code. It ensures that <em>kpm</em> or NuGet for that matter only check the feeds that are relevant to your project and not every feed that is configured on your system.</p>

{% include imported_disclaimer.html %}

