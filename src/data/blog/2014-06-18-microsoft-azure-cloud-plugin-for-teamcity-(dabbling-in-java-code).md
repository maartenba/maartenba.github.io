---
layout: post
title: "Microsoft Azure cloud plugin for TeamCity (dabbling in Java code)"
pubDatetime: 2014-06-18T07:34:00Z
comments: true
published: true
categories: ["post"]
tags: ["Azure", "General", "Personal", "Projects", "Scalability", "TeamCity"]
author: Maarten Balliauw
redirect_from:
  - /post/2014/06/18/microsoft-azure-cloud-plugin-for-teamcity-dabbling-in-java-code.html
---
<div style="padding: 4px; border-left-color: navy; border-left-width: 4px; border-left-style: solid; background-color: rgb(238, 238, 238);"><strong>NOTE:</strong> While the content is this blog post will still work, JetBrains now has a plugin that is the recommended way of working with TeamCity and build agents on Azure. Please check <a href="http://blog.jetbrains.com/teamcity/2014/11/introducing-teamcity-azure-plugin-run-builds-in-the-cloud/" target="_blank">this blog post</a> to learn more about it.</div>
<p><br></p><p>If you <a href="http://twitter.com/maartenballiauw">follow me on Twitter</a>, you may have seen me in several stages of anger at Java. After two weeks of learning, experimenting, coding and even getting it all to compile, I’m proud to announce an inital very early preview of my <a href="https://github.com/maartenba/teamcity-cloud-azure">Microsoft Azure cloud plugin for TeamCity</a>.</p> <p>This plugin provides Microsoft Azure cloud support for TeamCity. By configuring a Microsoft Azure cloud in TeamCity, a set of known virtual build agents can be started and stopped on demand by the TeamCity server so we can benefit from Microsoft Azure’s cost model (a stopped VM is almost free) and scaling model (only start new instances when we need them).</p> <p>Curious to try it? Make sure you <u>know it is all still very early alpha version software so use with caution</u>. I wanted to get an early preview out to gather some comments on it. Here are the installation steps:</p> <ul> <li>Download the plugin ZIP file <a href="https://github.com/maartenba/teamcity-cloud-azure/blob/master/releases">from the latest GitHub release</a>.  <li>Copy it to the TeamCity plugins folder  <li>Restart TeamCity server and verify the plugin was installed from <strong><em>Administration | Plugins List</em></strong> </li></ul> <h2>Creating a new cloud profile</h2> <p>From TeamCity’s <strong>Administration | Agent Cloud</strong>, we can create a new cloud configuration making use of the Microsoft Azure plugin for TeamCity. All we have to do is select “Microsoft Azure” as the cloud type and <a href="https://github.com/maartenba/teamcity-cloud-azure/blob/master/docs/cloud-profile.md">enter the requested details</a>.</p> <p><a href="/images/image_327.png"><img width="644" height="585" title="TeamCity agent on Azure VM" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" alt="TeamCity agent on Azure VM" src="/images/image_thumb_287.png" border="0"></a></p><!--EndFragment--> <p>Once we enter some <a href="https://github.com/maartenba/teamcity-cloud-azure/blob/master/docs/setup-build-agent-vm.md">preconfigured and pre-provisioned VM names</a>, we’re good to save and profit.</p> <p>Known issue: only one Microsoft Azure cloud configuration can be created per TeamCity server because the <em>KeyStore</em> being configured by the plugin only stores one management certificate. <a href="https://github.com/maartenba/teamcity-cloud-azure">Contribute a fix</a> if you feel up for it!</p> <h2>What’s up?</h2> <p>From <strong>Agents | Cloud</strong>, we can now see which VM instances are stopped/running on Microsoft Azure.</p> <p><a href="/images/image_328.png"><img width="644" height="97" title="Start stop TeamCity agent on Azure" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" alt="Start stop TeamCity agent on Azure" src="/images/image_thumb_288.png" border="0"></a></p> <p>Known issue: status of the VM displayed is not always current. The VM status is read from TeamCity's last known status, not from Microsoft Azure. Again, <a href="https://github.com/maartenba/teamcity-cloud-azure">contribute a fix</a> if you feel up for it.</p> <h2>What is there to come?</h2> <p>That’s pretty much it for now. I told you, it’s early. In my ideal world, there should also be a possibility to launch VM instances from a predefined image and destroy them when no longer needed. I also would love to convert it all to <a href="http://kotlin.jetbrains.com">Kotlin</a> as I still don’t like Java as a language and Kotlin looks really nice. ANd ideally, the crude UI I did for the plugin should be much nicer too.</p> <p>Happy building in the cloud!</p>



