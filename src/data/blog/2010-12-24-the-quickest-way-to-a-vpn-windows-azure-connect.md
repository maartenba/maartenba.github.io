---
layout: post
title: "The quickest way to a VPN: Windows Azure Connect"
pubDatetime: 2010-12-24T08:42:00Z
comments: true
published: true
categories: ["post"]
tags: ["Azure", "CSharp", "General", "Hardware"]
author: Maarten Balliauw
---
<p><a href="/images/1_1.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px 0px 5px 5px; padding-left: 0px; padding-right: 0px; display: inline; float: right; border-top: 0px; border-right: 0px; padding-top: 0px" title="Windows Azure Connect endpoint installer" src="/images/1_thumb_1.png" border="0" alt="Windows Azure Connect endpoint installer" width="244" height="192" align="right" /></a>First of all: Merry Christmas in advance! But to be honest, I already have my Christmas present&hellip; I&rsquo;ll give you a little story first as it&rsquo;s winter, dark outside and stories are better when it&rsquo;s winter and you are reading this post n front of your fireplace. Last week, I received the beta invite for <a href="http://www.microsoft.com/windowsazure/virtualnetwork/default.aspx" target="_blank">Windows Azure Connect</a>, a simple and easy-to-manage mechanism to setup IP-based network connectivity between on-premises and Windows Azure resources. Being targeted at interconnecting Windows Azure instances to your local network, it also contains a feature that allows interconnecting endpoints. Interesting!</p>
<p>Now why would that be interesting&hellip; Well, I recently moved into my own house, having lived with my parents since birth, now 27 years ago. During that time, I bought a <a href="http://www.microsoft.com/windows/products/winfamily/windowshomeserver/default.mspx" target="_blank">Windows Home Server</a> that was living happily in our home network and making backups of my PC, my work laptop, my father&rsquo;s PC and laptop and my brother&rsquo;s laptop. Oh right, and my virtual server hosting this blog and some other sites. Now what on earth does this have to do with Windows Azure Connect? Well, more then you may think&hellip;</p>
<p>I&rsquo;ve always been struggling with the idea on how to keep my Windows Home Server functional, between the home network at my place and the home network at my parents place. Having tried PPTP tunnels, IPSEC, <a href="http://openvpn.net/" target="_blank">OpenVPN</a>, <a href="http://www.teamviewer.com/" target="_blank">TeamViewer</a>&rsquo;s VPN capabilities, I found these solutions working but they required a lot of tweaking and installation woes. Not to mention that <a href="http://www.telenet.be" target="_blank">my ISP</a> (and almost all ISP&rsquo;s in Belgium) blocks inbound TCP connections to certain ports.</p>
<p>Untill I heard of Windows Azure Connect and that tiny checkbox on the management portal that states &ldquo;Allow connections between endpoints in group&rdquo;. Aha! So I started installing the Windows Azure Connect connector on all machines. A few times &ldquo;Next, I accept, Next, Finish&rdquo; later, all PC&rsquo;s, my virtual server and my homeserver were talking cloud with each other! Literally, it takes only a few minutes to set up a virtual network on multiple endpoints. And it also routes through proxies, which means that my homeserver should even be able to make backups of my work laptop when I&rsquo;m in the office with a very restrictive network. Restrictive for non-cloudians, that is :-)</p>
<h2>Installing Windows Azure Connect connector</h2>
<p>This one&rsquo;s easy. Navigate to <a href="http://windows.azure.com">http://windows.azure.com</a>, and in the management portal for Windows Azure Connect, click &ldquo;Install local endpoint&rdquo;.</p>
<p><a href="/images/image_80.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; margin-left: auto; border-top: 0px; margin-right: auto; border-right: 0px; padding-top: 0px" title="Windows Azure Connect management" src="/images/image_thumb_50.png" border="0" alt="Windows Azure Connect management" width="232" height="244" /></a></p>
<p>You will be presented a screen containing a link to the endpoint installer.</p>
<p><a href="/images/image_81.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; margin-left: auto; border-top: 0px; margin-right: auto; border-right: 0px; padding-top: 0px" title="Installing Windows Azure Connect" src="/images/image_thumb_51.png" border="0" alt="Installing Windows Azure Connect" width="644" height="297" /></a></p>
<p>Copy this link and make sure you write it down as you will need it for all machines that you want to join in your virtual network. I tried just copying the download to all machines and installing from there, but that does not seem to work. You really need a fresh download every time.</p>
<h2>Interconnecting machines</h2>
<p>This one&rsquo;s reall, really easy. I remember configuring Cisco routers when I was on school, but this approach is a lot easier I can tell you. Navigate to <a href="http://windows.azure.com">http://windows.azure.com</a> and open the Windows Azure Connect management interface. Click the &ldquo;Create group&rdquo; button in the top toolbar.</p>
<p><a href="/images/image_82.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; margin-left: auto; border-top: 0px; margin-right: auto; border-right: 0px; padding-top: 0px" title="Windows Azure Connect interconnecting" src="/images/image_thumb_52.png" border="0" alt="Windows Azure Connect interconnecting" width="244" height="114" /></a></p>
<p>Next, enter a name and an optional description for your virtual network. Next, add the endpoints that you&rsquo;ve installed. Note that it takes a while for them to appear, this can be forced by going to every machine that you installed the connector for and clicking the &ldquo;Refresh&rdquo; option in the system tray icon for Windows Azure Connect. Anyway, here are my settings:</p>
<p><a href="/images/image_83.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; margin-left: auto; border-top: 0px; margin-right: auto; border-right: 0px; padding-top: 0px" title="Windows Azure Connect create group" src="/images/image_thumb_53.png" border="0" alt="Windows Azure Connect create group" width="692" height="533" /></a></p>
<p>Make sure that you check &ldquo;Allow connections between endpoints in group&rdquo;. And eh&hellip; that&rsquo;s it! You now have interconnected your machines on different locations in about five minutes. Cloud power? For sure!</p>
<p>As a side node: it would be great if one endpoint could be joined to multiple &ldquo;groups&rdquo; or virtual networks. That would allow me to create a group for other siuations, and make my PC part of all these groups.</p>
<h2>Some findings</h2>
<p>Just for the techies out there, here&rsquo;s some findings&hellip; Let&rsquo;s start with doing an <em>ipconfig /all</em> on one of the interconnected machines:</p>
<p><a href="/images/image_84.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; margin-left: auto; border-top: 0px; margin-right: auto; border-right: 0px; padding-top: 0px" title="Windows Azure Connect ipv6" src="/images/image_thumb_54.png" border="0" alt="Windows Azure Connect ipv6" width="681" height="346" /></a></p>
<p>Windows Azure Connect really is a virtual PPP adapter added to your machine. It operates over IPv6. Let&rsquo;s see if we can ping other machines. <em>Ebh-vm05</em> is the virtual machine hosting my blog, running in a datacenter near Brussels. I&rsquo;m issuing this ping command from my work laptop in my parents home network near Antwerp. Here goes:</p>
<p><a href="/images/image_85.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; margin-left: auto; border-top: 0px; margin-right: auto; border-right: 0px; padding-top: 0px" title="Windows Azure Connect ping" src="/images/image_thumb_55.png" border="0" alt="Windows Azure Connect ping" width="681" height="346" /></a></p>
<p>Bam! Windows Azure Connect even seems to advertise hostnames on the virtual network! I like this very, very much! This would mean I can also do remote desktop between machines, even behind my company&rsquo;s restrictive proxy. I&rsquo;m going to try that one on monday. Eat that, corporate IT :-)</p>
<p>One last thing I&rsquo;m interested in: the IPv6 addresses of all connected machines seem to be in different subnets. Let&rsquo;s issue a traceroute as well.</p>
<p><a href="/images/image_86.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; margin-left: auto; border-top: 0px; margin-right: auto; border-right: 0px; padding-top: 0px" title="Windows Azure Connect trace route" src="/images/image_thumb_56.png" border="0" alt="Windows Azure Connect trace route" width="681" height="346" /></a></p>
<p>Sweet! It seems that there&rsquo;s routing going on inside Windows Azure Connect to communicate between all endpoints.</p>
<p>As a side node: yes, those are high ping times. But do note that I was at my parents home when taking this screenshot, and the microwave was defrosting Christmas meals between my laptop and the wireless access point.</p>
<h2>Conclusion</h2>
<p>I&rsquo;m probably abusing Windows Azure Connect doing this. However, it&rsquo;s a great use case in my opinion and I really hope Microsoft keeps supporting this. What would even be better is that they offered Windows Azure Connect in the setup I described above for home users as well. It would be a great addition to <a href="http://www.microsoft.com/windows/windowsintune/pc-management.aspx" target="_blank">Windows Intune</a> as well!</p>

{% include imported_disclaimer.html %}

